#!/bin/bash
# Enhanced pre-commit hook with comprehensive verification

set -e

echo "ğŸ” Running pre-commit verification..."

# Check version bump for feature/fix branches
./scripts/check-version-bump.sh || exit 1

# Set dummy environment variables for build
export DATABASE_URL="postgresql://dummy:dummy@localhost:5432/dummy"
export NEXTAUTH_SECRET="dummy-secret-for-build"
export NEXTAUTH_URL="http://localhost:3000"

# 1. Build verification
echo "ğŸ“¦ Building application..."
if ! npm run build; then
  echo "âŒ Build failed. Please fix build errors before committing."
  exit 1
fi

# 2. Test execution
echo "ğŸ§ª Running tests..."
if ! npm test; then
  echo "âŒ Tests failed. Please fix failing tests before committing."
  exit 1
fi

# 3. Lint check (warning only, doesn't block)
echo "ğŸ” Running linter..."
npm run lint || echo "âš ï¸  Linting issues detected (not blocking commit)"

echo "âœ… Pre-commit verification passed!"